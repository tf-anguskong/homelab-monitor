# Telegraf configuration for Synology NAS (runs in Docker container)
# Install script substitutes INFLUXDB_SERVER_URL and WRITE_TOKEN_HERE
# SYNOLOGY_HOSTNAME is injected via the container environment variable

[global_tags]
  host = "${SYNOLOGY_HOSTNAME}"
  role = "agent"

[agent]
  interval = "10s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "1s"
  flush_interval = "10s"
  flush_jitter = "2s"
  precision = "1s"
  omit_hostname = true  # hostname comes from global_tag above

[[outputs.influxdb_v2]]
  urls = ["INFLUXDB_SERVER_URL"]
  token = "WRITE_TOKEN_HERE"
  organization = "homelab"
  bucket = "powermon"
  timeout = "10s"

# ── CPU metrics ───────────────────────────────────────────────────────────────
[[inputs.cpu]]
  percpu = false
  totalcpu = true
  collect_cpu_time = false
  report_active = false

# ── Memory metrics ────────────────────────────────────────────────────────────
[[inputs.mem]]

# ── Disk usage (Synology volumes + system) ────────────────────────────────────
[[inputs.disk]]
  # Ignore virtual and Docker-internal filesystems; keep /volume* and /
  ignore_fs = [
    "tmpfs", "devtmpfs", "devfs", "proc", "sysfs", "cgroup",
    "overlay", "aufs", "squashfs", "nsfs"
  ]

[[inputs.diskio]]

# ── Network metrics ───────────────────────────────────────────────────────────
# network_mode: host in docker-compose exposes the real NAS interfaces
[[inputs.net]]
  ignore_protocol_stats = true

# ── System metrics ────────────────────────────────────────────────────────────
[[inputs.system]]

[[inputs.processes]]
