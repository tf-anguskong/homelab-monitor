# Telegraf configuration for macOS power monitoring agent
# Install script substitutes INFLUXDB_SERVER_URL and WRITE_TOKEN_HERE

[global_tags]
  host = "$HOSTNAME"
  role = "agent"

[agent]
  interval = "10s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "1s"
  flush_interval = "10s"
  flush_jitter = "2s"
  precision = "1s"
  hostname = ""
  omit_hostname = false

[[outputs.influxdb_v2]]
  urls = ["INFLUXDB_SERVER_URL"]
  token = "WRITE_TOKEN_HERE"
  organization = "homelab"
  bucket = "powermon"
  timeout = "10s"

# ── Power metrics via powermetrics ────────────────────────────────────────────
# Script runs as root (via LaunchDaemon), so no sudo needed here
[[inputs.exec]]
  commands = ["/usr/local/etc/telegraf/scripts/macos-power.sh"]
  timeout = "10s"
  data_format = "influx"
  interval = "10s"

# ── CPU metrics ───────────────────────────────────────────────────────────────
[[inputs.cpu]]
  percpu = false
  totalcpu = true
  collect_cpu_time = false
  report_active = false

# ── Memory metrics ────────────────────────────────────────────────────────────
[[inputs.mem]]

# ── Disk metrics ──────────────────────────────────────────────────────────────
[[inputs.disk]]
  ignore_fs = ["devfs", "autofs", "tmpfs", "map auto_home"]

[[inputs.diskio]]

# ── Network metrics ───────────────────────────────────────────────────────────
[[inputs.net]]
  ignore_protocol_stats = true

# ── System metrics ────────────────────────────────────────────────────────────
[[inputs.system]]

[[inputs.processes]]
