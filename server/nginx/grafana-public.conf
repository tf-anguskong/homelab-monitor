server {
    listen 80;

    # Public dashboard page
    location /public-dashboards/ {
        proxy_pass http://grafana:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Static assets (JS, CSS, fonts) required to render the dashboard
    location /public/ {
        proxy_pass http://grafana:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Public dashboard data API (panel queries, metadata)
    location /api/public/ {
        proxy_pass http://grafana:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Redirect root to the public dashboard
    location = / {
        return 301 /public-dashboards/c9373a8d1d774f6087bdeaa85e0e9fa7?orgId=1&refresh=10s;
    }

    # Block everything else
    location / {
        return 403;
    }
}
